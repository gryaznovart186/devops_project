# Описание конвейера и файлов для деплоя приложения
## Оглавление
- [Описание файлов](#описание-файлов)
- [Описание конвейера](#описание-конвейера)

## Описание файлов
В папке **app-files/** содержатся файлы для деплоя приложений:
- **.gitlab-ci-app.yml** — описание конвейера для приложения crawler;
- **.gitlab-ci-ui.yml** — описание конвейера для приложения ui;
- **Dockerfile-Crawler-App** — Dockerfile для сборки образа приложения crawler;
- **Dockerfile-Crawler-UI** — Dockerfile для сборки образа приложения ui;

Если в репозиториях приложений отсутствуют файлы **Dockerfile** и **.gitlab-ci.yml**, то их необходимо скопировать из этой папки и переименовать.

## Описание конвейера
Конвейер состоит из следующих шагов:
1. build:
    - сборка образа приложения;
    - вход в Docker Hub;
    - загрузка собранного образа в Docker Hub и удаление его на машине.
2. test:
    - запуск unit-тестов.
3. stage:
    - установка OpenSSH в контейнер раннера для подключения к серверу **stage** по SSH;
    - подключение к серверу **stage** по SSH;
    - остановка и удаление контейнера приложения на сервере **stage**;
    - запуск нового контейнера приложения на сервере **stage**;
    - создание Gitlab-окружения **stage**, доступного по адресу **http://\<stage-IP\>:8000**.
4. production:
    - установка OpenSSH в контейнер раннера для подключения к серверу **prod** по SSH;
    - подключение к серверу **prod** по SSH;
    - остановка и удаление контейнера приложения на сервере **prod**;
    - запуск нового контейнера приложения на сервере **prod**;
    - создание Gitlab-окружения **production**, доступного по адресу **http://\<prod-IP\>:8000**.

Шаг **production** становится доступен только при публикации приложения из ветки **master**.

Шаг **production** запускается вручную.

<br/>

[Вернуться на главную страницу](../README.md)
